<html>
  <head>
    <title>HTML5 Alarm Clock</title>
    <script type='text/javascript'>
      var target = null;
      var ctx = new AudioContext();

      function parseTime(timeStr, dt) {
        if (!dt) {
          dt = new Date();
        }

        var time = timeStr.match(/(\d+)(?::(\d\d))?\s*(p?)/i);
        if (!time) {
          return NaN;
        }
        var hours = parseInt(time[1], 10);
        if (hours == 12 && !time[3]) {
          hours = 0;
        }
        else {
          hours += (hours < 12 && time[3]) ? 12 : 0;
        }

        dt.setHours(hours);
        dt.setMinutes(parseInt(time[2], 10) || 0);
        dt.setSeconds(0, 0);
        return dt;
      }

      function pad(n, width, z) {
        z = z || '0';
        n = n + '';
        return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
      }

      function updateStatus(){
        var sf = document.querySelector('.statusField');
        if(target){
          if((new Date()).getTime() > target.getTime()){
            sf.value = 'Beep! Beep! Beep!';
            var oscillator = ctx.createOscillator();
            oscillator.type = 'sine';
            oscillator.connect(ctx.destination);
            oscillator.frequency.value = Math.random()*500 + 750;
            // oscillator.noteOn && oscillator.noteOn(0);
            oscillator.start();
            //setTimeout(function(){ oscillator.noteOff && oscillator.noteOff(0); }, 500)
            setTimeout(function(){ oscillator.stop(); }, 500)
          } else {
            var dH = ((target.getTime() - (new Date()).getTime())/(1000*60*60))|0;
            var dM = (((target.getTime() - (new Date()).getTime())/(1000*60)|0) - (60*dH));
            var dS = (((target.getTime() - (new Date()).getTime())/(1000)|0) - (60*dM) - (60*60*dH));

            sf.value = 'Alarm set to ' + target.getHours() + ':' + pad(target.getMinutes(), 2) + '. ';
            sf.value += dH + ':' + pad(dM, 2) + ':' + pad(dS, 2) + ' remaining.';
          }
        } else {
          sf.value = 'Alarm not running';
        }
      }

      function setAlarm(){
        var tf = document.querySelector('.timeField');
        target = parseTime(tf.value);
        if((new Date()).getTime() > target.getTime()){
          target.setDate(target.getDate()+1)
        }
      }

      function snooze(){
        if(target){
          target.setMinutes(target.getMinutes()+10);
        }
      }

      function stopAlarm(){
        target = null;
      }

      function init(){
        setInterval(updateStatus, 1000);
      }
    </script>
  </head>
  <body onload='init()'>
    <center>
      <h1>Alarm Clock</h1><br>
      Time: <input type='text' class='timeField'><br>
      <input type='button' value='Set Alarm' onclick='setAlarm()'>
      <input type='button' value='Snooze' onclick='snooze()'>
      <input type='button' value='Stop Alarm' onclick='stopAlarm()'>
      <br>
      Status: <input type='text' class='statusField' size=50>
    </center>
  </body>
</html>
